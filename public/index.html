<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chile en LÃ­nea - Foro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="forum-header">
            <h1>Chile en LÃ­nea</h1>
        </header>

        <!-- Banner de bienvenida -->
        <div class="welcome-banner">
            <span class="welcome-icon">ðŸ‘‹</span>
            <span class="welcome-text">
                Â¡Bienvenido a Chile en LÃ­nea! 
                <a href="/register" class="welcome-link">RegÃ­strate</a> 
                o 
                <a href="/login" class="welcome-link">Inicia sesiÃ³n</a> 
                para participar en la comunidad
            </span>
        </div>

        <main class="forum-container">
            <!-- SecciÃ³n de Support -->
            <div class="forum-section">
                <div class="section-header">
                    <h2>Inicio</h2>
                    <button class="toggle-btn">â–¼</button>
                </div>

                <!-- CategorÃ­a: General Support -->
                <div class="category-row">
                    <div class="category-icon">
                        <div class="icon-circle"></div>
                    </div>
                    
                    <div class="category-info">
                        <a href="/category"><h3 class="category-title">Soporte General</h3></a>
                        <p class="category-description">Soporte general del foro, para cualquier consulta o problema.</p>
                    </div>

                    <div class="category-stats">
                        <div class="stat">
                            <span class="stat-number" id="posts-count">0</span>
                            <span class="stat-label">Mensajes</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number" id="threads-count">0</span>
                            <span class="stat-label">Temas</span>
                        </div>
                    </div>

                    <div class="category-latest">
                        <div class="latest-post" id="latest-post">
                            <a href="#" class="latest-post-title" id="latest-post-title">Cargando...</a>
                            <div class="latest-post-meta">
                                <span class="latest-post-time" id="latest-post-time"></span>
                                <span class="latest-post-author">por <a href="#" id="latest-post-author"></a></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Board Statistics -->
            <div class="forum-section">
                <div class="section-header">
                    <h2>EstadÃ­sticas del Foro</h2>
                </div>
                <div class="board-statistics">
                    <p>Nuestros miembros han creado un total de <strong id="total-posts-stat">0</strong> mensajes en <strong id="total-threads-stat">0</strong> temas.</p>
                    <p>Actualmente tenemos <strong id="total-members-stat">0</strong> miembros registrados.</p>
                    <p>Por favor dale la bienvenida a nuestro miembro mÃ¡s reciente, <a href="#" id="newest-member-link"><strong id="newest-member-stat">Cargando...</strong></a></p>
                    <p>La mayor cantidad de usuarios en lÃ­nea fue <strong id="most-online-stat">0</strong> el <strong id="most-online-date">--</strong></p>
                </div>
            </div>
        </main>
    </div>
    <script>
        // Cargar estadÃ­sticas desde la API
        fetch('/api/stats')
            .then(response => response.json())
            .then(data => {
                document.getElementById('posts-count').textContent = data.posts.toLocaleString();
                document.getElementById('threads-count').textContent = data.threads.toLocaleString();
                
                // Cargar Ãºltimo post
                if (data.latestPost) {
                    const timeAgo = getTimeAgo(new Date(data.latestPost.createdAt));
                    document.getElementById('latest-post-title').textContent = data.latestPost.title;
                    document.getElementById('latest-post-time').textContent = timeAgo;
                    document.getElementById('latest-post-author').textContent = data.latestPost.author;
                    document.querySelector('.latest-post-author').style.display = '';
                } else {
                    document.getElementById('latest-post-title').textContent = 'No hay posts aÃºn';
                    document.getElementById('latest-post-time').textContent = '';
                    document.getElementById('latest-post-author').textContent = '';
                    document.querySelector('.latest-post-author').style.display = 'none';
                }

                // Cargar estadÃ­sticas del foro
                if (data.boardStats) {
                    document.getElementById('total-posts-stat').textContent = data.boardStats.totalPosts.toLocaleString();
                    document.getElementById('total-threads-stat').textContent = data.boardStats.totalThreads.toLocaleString();
                    document.getElementById('total-members-stat').textContent = data.boardStats.totalMembers.toLocaleString();
                    document.getElementById('newest-member-stat').textContent = data.boardStats.newestMember || 'N/A';
                    document.getElementById('newest-member-link').href = `/user/${data.boardStats.newestMember}`;
                    document.getElementById('most-online-stat').textContent = data.boardStats.mostOnline || 0;
                    document.getElementById('most-online-date').textContent = data.boardStats.mostOnlineDate || '--';
                }
            })
            .catch(error => console.error('Error cargando estadÃ­sticas:', error));
        
        // FunciÃ³n para calcular tiempo relativo
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            const intervals = {
                aÃ±o: 31536000,
                mes: 2592000,
                semana: 604800,
                dÃ­a: 86400,
                hora: 3600,
                minuto: 60
            };
            
            for (const [name, secondsInInterval] of Object.entries(intervals)) {
                const interval = Math.floor(seconds / secondsInInterval);
                if (interval >= 1) {
                    return `hace ${interval} ${name}${interval !== 1 ? 's' : ''}`;
                }
            }
            return 'hace un momento';
        }
    </script>
</body>
</html>
